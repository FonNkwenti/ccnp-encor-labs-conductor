!
! R1 Solution Configuration
! BGP Lab 09 - BGP Authentication & Security
!
hostname R1
!
interface Loopback0
 ip address 172.16.1.1 255.255.255.255
 no shutdown
!
interface Loopback1
 ip address 192.168.1.1 255.255.255.0
 no shutdown
!
interface Loopback2
 ip address 192.168.2.1 255.255.255.0
 no shutdown
!
interface Loopback3
 ip address 192.168.3.1 255.255.255.0
 no shutdown
!
interface FastEthernet0/0
 description Link to R4 (Enterprise Internal)
 ip address 10.1.14.1 255.255.255.252
 no shutdown
!
interface FastEthernet1/0
 description Link to R2 (ISP-A) — Primary
 ip address 10.1.12.1 255.255.255.252
 no shutdown
!
interface FastEthernet1/1
 description Link to R3 (ISP-B) — Secondary
 ip address 10.1.13.1 255.255.255.252
 no shutdown
!
interface GigabitEthernet3/0
 description Link to R6 (Enterprise Edge 2)
 ip address 10.1.16.1 255.255.255.252
 no shutdown
!
router ospf 1
 router-id 172.16.1.1
 network 10.1.14.0 0.0.0.3 area 0
 network 10.1.16.0 0.0.0.3 area 0
 network 172.16.1.1 0.0.0.0 area 0
!
! ============================================================
! Traffic engineering policy (carried forward from Lab 07)
! ============================================================
ip prefix-list ISP-A-PREFIXES seq 10 permit 198.51.100.0/24
ip prefix-list ISP-A-PREFIXES seq 20 permit 198.51.101.0/24
ip prefix-list ISP-A-PREFIXES seq 30 permit 198.51.102.0/24
!
ip prefix-list ISP-B-PREFIXES seq 10 permit 203.0.113.0/24
ip prefix-list ISP-B-PREFIXES seq 20 permit 203.0.114.0/24
ip prefix-list ISP-B-PREFIXES seq 30 permit 203.0.115.0/24
!
ip prefix-list ISP-A-REACHABILITY seq 10 permit 198.51.100.0/24
!
ip prefix-list ENTERPRISE-192-168-1 seq 10 permit 192.168.1.0/24
ip prefix-list ENTERPRISE-192-168-2 seq 10 permit 192.168.2.0/24
ip prefix-list ENTERPRISE-192-168-3 seq 10 permit 192.168.3.0/24
!
! ============================================================
! Task 4: Bogon prefix-list — match IANA-reserved and private space
! ============================================================
ip prefix-list BOGON-PREFIXES seq 10 permit 0.0.0.0/8 le 32
ip prefix-list BOGON-PREFIXES seq 20 permit 10.0.0.0/8 le 32
ip prefix-list BOGON-PREFIXES seq 30 permit 127.0.0.0/8 le 32
ip prefix-list BOGON-PREFIXES seq 40 permit 169.254.0.0/16 le 32
ip prefix-list BOGON-PREFIXES seq 50 permit 172.16.0.0/12 le 32
ip prefix-list BOGON-PREFIXES seq 60 permit 192.0.2.0/24 le 32
ip prefix-list BOGON-PREFIXES seq 70 permit 192.168.0.0/16 le 32
ip prefix-list BOGON-PREFIXES seq 80 permit 198.18.0.0/15 le 32
ip prefix-list BOGON-PREFIXES seq 90 permit 240.0.0.0/4 le 32
!
! ============================================================
! Task 4: ISP-A inbound — deny bogons first (seq 5), then LP policy
! ============================================================
route-map ISP-A-IN deny 5
 match ip address prefix-list BOGON-PREFIXES
!
route-map ISP-A-IN permit 10
 match ip address prefix-list ISP-A-PREFIXES
 set local-preference 200
!
route-map ISP-A-IN permit 20
 set local-preference 100
!
! ============================================================
! Task 4: ISP-B inbound — deny bogons first (seq 5), then LP policy
! ============================================================
route-map ISP-B-IN deny 5
 match ip address prefix-list BOGON-PREFIXES
!
route-map ISP-B-IN permit 10
 match ip address prefix-list ISP-B-PREFIXES
 set local-preference 200
!
route-map ISP-B-IN permit 20
 set local-preference 100
!
route-map OUTBOUND-ISP-A permit 10
 match ip address prefix-list ENTERPRISE-192-168-1
 set as-path prepend 65001 65001 65001
!
route-map OUTBOUND-ISP-A permit 20
 match ip address prefix-list ENTERPRISE-192-168-3
 set metric 10
!
route-map OUTBOUND-ISP-A permit 30
!
route-map OUTBOUND-ISP-B permit 10
 match ip address prefix-list ENTERPRISE-192-168-2
 set as-path prepend 65001 65001 65001
!
route-map OUTBOUND-ISP-B permit 20
 match ip address prefix-list ENTERPRISE-192-168-3
 set metric 100
!
route-map OUTBOUND-ISP-B permit 30
!
route-map CHECK-ISP-UP permit 10
 match ip address prefix-list ISP-A-REACHABILITY
!
! ============================================================
! Route Reflector + Security hardening (Tasks 1, 2, 3)
! ============================================================
router bgp 65001
 bgp router-id 172.16.1.1
 bgp cluster-id 1
 !
 ! Task 1: MD5 auth | Task 2: TTL security | Task 3: max-prefix
 neighbor 10.1.12.2 remote-as 65002
 neighbor 10.1.12.2 password BGP_LAB_KEY
 neighbor 10.1.12.2 ttl-security hops 1
 neighbor 10.1.12.2 maximum-prefix 200 80
 neighbor 10.1.12.2 soft-reconfiguration inbound
 neighbor 10.1.12.2 route-map ISP-A-IN in
 neighbor 10.1.12.2 route-map OUTBOUND-ISP-A out
 !
 neighbor 10.1.13.2 remote-as 65003
 neighbor 10.1.13.2 password BGP_LAB_KEY
 neighbor 10.1.13.2 ttl-security hops 1
 neighbor 10.1.13.2 maximum-prefix 200 80
 neighbor 10.1.13.2 soft-reconfiguration inbound
 neighbor 10.1.13.2 route-map ISP-B-IN in
 neighbor 10.1.13.2 route-map OUTBOUND-ISP-B out
 !
 ! Task 1: iBGP MD5 auth (no GTSM — loopback-sourced multi-hop)
 neighbor 172.16.4.4 remote-as 65001
 neighbor 172.16.4.4 update-source Loopback0
 neighbor 172.16.4.4 next-hop-self
 neighbor 172.16.4.4 password IBGP_LAB_KEY
 neighbor 172.16.4.4 route-reflector-client
 neighbor 172.16.4.4 default-originate route-map CHECK-ISP-UP
 !
 neighbor 172.16.6.6 remote-as 65001
 neighbor 172.16.6.6 update-source Loopback0
 neighbor 172.16.6.6 next-hop-self
 neighbor 172.16.6.6 password IBGP_LAB_KEY
 neighbor 172.16.6.6 route-reflector-client
 !
 network 172.16.1.1 mask 255.255.255.255
 network 192.168.1.0 mask 255.255.255.0
 network 192.168.2.0 mask 255.255.255.0
 network 192.168.3.0 mask 255.255.255.0
!
line con 0
 logging synchronous
 exec-timeout 0 0
!
end
