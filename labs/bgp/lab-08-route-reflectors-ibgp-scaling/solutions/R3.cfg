!
! R3 Solution Configuration
! BGP Lab 08 - Route Reflectors & iBGP Scaling
! (No changes â€” R3 is ISP-B; RR config is internal to the Enterprise AS)
!
hostname R3
!
interface Loopback0
 ip address 172.16.3.3 255.255.255.255
 no shutdown
!
interface Loopback1
 ip address 203.0.113.1 255.255.255.0
 no shutdown
!
interface Loopback2
 ip address 203.0.114.1 255.255.255.0
 no shutdown
!
interface Loopback3
 ip address 203.0.115.1 255.255.255.0
 no shutdown
!
interface FastEthernet0/0
 description Link to R2 (ISP-A)
 ip address 10.1.23.2 255.255.255.252
 no shutdown
!
interface FastEthernet1/0
 description Link to R1 (Enterprise)
 ip address 10.1.13.2 255.255.255.252
 no shutdown
!
interface FastEthernet1/1
 description Link to R5 (Downstream Customer)
 ip address 10.1.35.1 255.255.255.252
 no shutdown
!
ip prefix-list ISP-B-INTERNAL seq 10 permit 203.0.115.0/24
!
ip community-list standard R5-PREFERRED permit 65004:100
!
route-map POLICY-TO-R5 permit 10
 match ip address prefix-list ISP-B-INTERNAL
 set community no-export
!
route-map POLICY-TO-R5 permit 20
!
route-map POLICY-FROM-R5 permit 10
 match community R5-PREFERRED
 set local-preference 180
!
route-map POLICY-FROM-R5 permit 20
!
router bgp 65003
 bgp router-id 172.16.3.3
 neighbor 10.1.13.1 remote-as 65001
 neighbor 10.1.13.1 soft-reconfiguration inbound
 neighbor 10.1.23.1 remote-as 65002
 neighbor 10.1.35.2 remote-as 65004
 neighbor 10.1.35.2 soft-reconfiguration inbound
 neighbor 10.1.35.2 send-community
 neighbor 10.1.35.2 route-map POLICY-FROM-R5 in
 neighbor 10.1.35.2 route-map POLICY-TO-R5 out
 !
 network 172.16.3.3 mask 255.255.255.255
 network 203.0.113.0 mask 255.255.255.0
 network 203.0.114.0 mask 255.255.255.0
 network 203.0.115.0 mask 255.255.255.0
!
line con 0
 logging synchronous
 exec-timeout 0 0
!
end
