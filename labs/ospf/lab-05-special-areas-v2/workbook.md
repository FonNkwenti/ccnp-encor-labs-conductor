# CCNP ENCOR OSPF Lab 05: OSPF Special Area Types
**Student Workbook & Instructor Guide**

---

## Table of Contents

1. [Concepts & Skills Covered](#1-concepts--skills-covered)
2. [Topology & Scenario](#2-topology--scenario)
3. [Hardware & Environment Specifications](#3-hardware--environment-specifications)
4. [Base Configuration](#4-base-configuration)
5. [Lab Challenge: Core Implementation](#5-lab-challenge-core-implementation)
6. [Verification & Analysis](#6-verification--analysis)
7. [Verification Cheatsheet](#7-verification-cheatsheet)
8. [Solutions (Spoiler Alert!)](#8-solutions-spoiler-alert)
9. [Troubleshooting Scenarios](#9-troubleshooting-scenarios)
10. [Lab Completion Checklist](#10-lab-completion-checklist)

---

## 1. Concepts & Skills Covered

**Exam Objective:** 3.2.a — Compare routing concepts of OSPF (area types) | 3.2.b — Configure simple OSPFv2 environments including multiple normal areas and filtering

OSPF's power lies in its ability to tightly control LSA flooding between areas. Special area types — Stub, Totally Stubby, and NSSA — give the network designer tools to reduce routing overhead in peripheral areas by limiting which LSA types can enter. This lab builds on the multi-area topology from Lab 04 by adding a branch router (R7) into a new Area 2, then progressively restricting what R7 sees in its Link-State Database. You will observe the exact impact on the routing table and LSDB at each configuration step.

### OSPF LSA Types and Flooding Scope

OSPF uses distinct LSA types to describe different parts of the network. Each type has a defined flooding boundary that controls how far it propagates:

| LSA Type | Name               | Flooding Scope | Generated By          |
|----------|--------------------|----------------|-----------------------|
| Type 1   | Router LSA         | Area-local     | Every OSPF router     |
| Type 2   | Network LSA        | Area-local     | DR (broadcast links)  |
| Type 3   | Summary LSA        | Inter-area     | ABR                   |
| Type 4   | ASBR Summary LSA   | Inter-area     | ABR (toward ASBR)     |
| Type 5   | AS External LSA    | Domain-wide    | ASBR                  |
| Type 7   | NSSA External LSA  | NSSA-local     | ASBR inside NSSA      |

In a **normal area**, all LSA types propagate freely. Special area types impose restrictions at the ABR boundary. Understanding which types are blocked — and which default route is injected to compensate — is the core skill this lab develops.

### Stub Areas

A Stub area blocks **Type 4 (ASBR Summary) and Type 5 (AS External) LSAs** from entering. Because external routes cannot reach stub routers, the ABR automatically injects a **Type 3 default route (0.0.0.0/0)** into the stub area so that traffic to external destinations can still be forwarded.

Key constraints:
- Every router inside the stub area must be configured as stub — a single non-stub router breaks all adjacencies in the area.
- ASBRs cannot reside inside a stub area (no mechanism to advertise external routes from within).
- Virtual links cannot transit a stub area.
- The default route is injected by the ABR automatically — no extra configuration required.

```
! Applied to every router in the stub area (ABR and internal routers)
router ospf 1
 area 2 stub
```

**LSDB result:** Type 1, 2, and 3 LSAs present. Type 4 and Type 5 absent. One Type 3 default route (0.0.0.0/0) injected by ABR.

### Totally Stubby Areas

Totally Stubby takes restriction further by also filtering **Type 3 Summary LSAs** (inter-area routes). The only LSA allowed in from outside is the single Type 3 default route injected by the ABR. This produces the smallest possible LSDB for a stub area — only intra-area Type 1/2 LSAs plus one default.

Key constraints:
- Only the **ABR** uses `area X stub no-summary`. Internal routers continue to use `area X stub`.
- The `no-summary` keyword is a Cisco IOS extension — not defined in RFC 2328.
- The ABR still injects the default route automatically.

```
! ABR only
router ospf 1
 area 2 stub no-summary

! Internal routers — no change from regular stub
router ospf 1
 area 2 stub
```

**LSDB result:** Only Type 1 and Type 2 LSAs from within Area 2, plus a single Type 3 default route. All inter-area Type 3 LSAs are filtered.

### ABR Route Summarization

An ABR can aggregate multiple specific prefixes from one area into a single summary advertised into the backbone. This is configured with `area range` on the ABR and applied to the source area.

```
! On R3 (ABR for Area 2) — summarize Area 2 prefixes toward Area 0
router ospf 1
 area 2 range 10.37.0.0 255.255.255.248
```

When a summary is configured, the ABR suppresses the individual component routes and advertises only the aggregate. If no component routes exist, the summary is withdrawn automatically. The ABR also installs a null route to the summary prefix locally to prevent routing loops.

> **Exam note:** `area range` summarizes routes *from* the specified area *into* other areas. It is applied on the ABR and references the area where the specific prefixes originate.

**Skills this lab develops:**

| Skill                          | Description                                                                 |
|--------------------------------|-----------------------------------------------------------------------------|
| Stub area configuration        | Restricting Type 4/5 LSAs from entering a peripheral area                  |
| Totally Stubby configuration   | Restricting all inter-area LSAs except the ABR-injected default route       |
| LSDB analysis                  | Identifying LSA types present before and after area type changes            |
| Default route verification     | Confirming the Type 3 default route injected by the ABR in stub areas       |
| ABR summarization              | Aggregating Area 2 prefixes at the boundary to reduce Type 3 LSA count      |

---

## 2. Topology & Scenario

**Enterprise Context:** You are a network engineer at Acme Corp. The core OSPF domain (Area 0 backbone and Area 1 distribution) is fully operational from the previous lab. A small branch office has come online — router R7 — connected to the distribution layer via R3. This branch has no locally redistributed external routes and no need to maintain a full copy of the enterprise routing table. Your task is to integrate R7 into OSPF Area 2, then progressively restrict its LSDB using stub and totally stubby area configurations to minimize memory and CPU overhead at the branch site.

### ASCII Diagram

```
                         ┌───────────────────────┐
                         │          R1           │
                         │      Hub / ABR        │
                         │   Lo0: 10.1.1.1/32    │
                         └───────┬───────┬───────┘
                     Fa1/0       │       │       Fa1/1
               10.12.0.1/30      │Area 0 │    10.13.0.1/30
                                 │       │
               10.12.0.2/30      │       │    10.13.0.2/30
                     Fa0/0       │       │       Fa0/1
              ┌──────────────────┘       └──────────────────┐
              │                                             │
   ┌──────────┴──────────┐                   ┌─────────────┴──────────┐
   │         R2          │                   │           R3           │
   │   Backbone Router   │                   │  Branch Router / ABR   │
   │   Lo0:10.2.2.2/32   │                   │   Lo0: 10.3.3.3/32     │
   └──────────┬──────────┘                   └──────────────┬─────────┘
          Fa0/1│                                         Fa1/1│
    10.23.0.1/30│ ◄─────────── Area 1 ──────────────► │10.37.0.1/30
                │                                           │  Area 2
    10.23.0.2/30│                               10.37.0.2/30│
          Fa0/0 │                                     Fa0/0 │
              ┌─┘                                         ┌─┘
              │ (R2 Fa0/1 ↔ R3 Fa0/0 via 10.23.0.0/30)   │
              └──────────────────────────────────┐        │
                                                 │   ┌────┘
                                            ┌────┴───┴────────┐
                                            │       R7        │
                                            │   Stub Router   │
                                            │ Lo0:10.7.7.7/32 │
                                            └─────────────────┘
```

**Area Summary:**

| Area   | Routers         | Links                        | Type          |
|--------|-----------------|------------------------------|---------------|
| Area 0 | R1, R2, R3      | R1-R2 (10.12.0.0/30), R1-R3 (10.13.0.0/30) | Backbone |
| Area 1 | R2, R3          | R2-R3 (10.23.0.0/30)         | Normal        |
| Area 2 | R3 (ABR), R7    | R3-R7 (10.37.0.0/30)         | Stub / Totally Stubby |

---

## 3. Hardware & Environment Specifications

### Device Summary

| Device | Platform | Role              | Loopback0       | Console Port |
|--------|----------|-------------------|-----------------|--------------|
| R1     | c7200    | Hub / ABR         | 10.1.1.1/32     | 5001         |
| R2     | c7200    | Backbone Router   | 10.2.2.2/32     | 5002         |
| R3     | c7200    | Branch Router/ABR | 10.3.3.3/32     | 5003         |
| R7     | c3725    | Stub Router       | 10.7.7.7/32     | 5007         |

### Cabling

| Link | Source          | Destination      | Subnet          | Area   |
|------|-----------------|------------------|-----------------|--------|
| L1   | R1 Fa1/0        | R2 Fa0/0         | 10.12.0.0/30    | Area 0 |
| L2   | R2 Fa0/1        | R3 Fa0/0         | 10.23.0.0/30    | Area 1 |
| L3   | R1 Fa1/1        | R3 Fa0/1         | 10.13.0.0/30    | Area 0 |
| L6   | R3 Fa1/1        | R7 Fa0/0         | 10.37.0.0/30    | Area 2 |

### Console Access Table

| Device | Port | Connection Command          |
|--------|------|-----------------------------|
| R1     | 5001 | `telnet 127.0.0.1 5001`     |
| R2     | 5002 | `telnet 127.0.0.1 5002`     |
| R3     | 5003 | `telnet 127.0.0.1 5003`     |
| R7     | 5007 | `telnet 127.0.0.1 5007`     |

---

## 4. Base Configuration

The `initial-configs/` directory pre-loads the following on each device:

**Pre-configured (carried forward from Lab 04):**
- Hostnames and interface IP addressing on R1, R2, R3
- OSPF process 1 on R1, R2, R3 with router IDs and reference bandwidth
- Area 0 adjacencies: R1-R2 and R1-R3 (point-to-point)
- Area 1 adjacency: R2-R3
- R3 Fa1/1 interface with IP addressing for the R3-R7 link (not yet in OSPF)
- R7 hostname, Loopback0, and Fa0/0 IP addressing

**NOT pre-configured — student must build:**
- OSPF routing process on R7
- Area 2 participation for R3 and R7
- Stub area type configuration on Area 2
- Totally Stubby configuration on R3
- ABR route summarization for Area 2 prefixes

---

## 5. Lab Challenge: Core Implementation

### Task 1: Establish R7 in the OSPF Domain

- Enable an OSPF routing process on R7 using process ID 1 and set its router ID to its Loopback0 address.
- Advertise R7's Loopback0 prefix and the R3-R7 link subnet into Area 2 as a **normal** (non-stub) area first — this gives you a baseline LSDB to compare against.
- On R3, add the R3-R7 link subnet to OSPF in Area 2 (normal area).
- Confirm adjacency and verify that R7's routing table includes inter-area routes from Area 0 and Area 1.

**Verification:** `show ip ospf neighbor` on R3 must show R7 in FULL state. `show ip route ospf` on R7 must display inter-area routes (prefix `O IA`) for Area 0 and Area 1 subnets.

---

### Task 2: Configure Area 2 as a Stub Area

- Configure Area 2 as a stub area on **both** R3 (the ABR) and R7 (the internal router).
- After applying stub configuration on both sides, verify the adjacency re-establishes.
- Examine R7's LSDB and confirm that Type 4 and Type 5 LSAs are absent.
- Confirm that a default route (0.0.0.0/0) has been injected into Area 2 by R3 as a Type 3 Summary LSA.

**Verification:** `show ip ospf database` on R7 must show no Type 4 or Type 5 entries. `show ip route` on R7 must include a default route (`O*IA 0.0.0.0/0`) via R3.

---

### Task 3: Upgrade Area 2 to Totally Stubby

- Modify R3's stub configuration with the Cisco IOS keyword that suppresses all inter-area Summary LSAs from entering Area 2 — only the default route should remain.
- R7's configuration requires **no change** for this step.
- Verify that R7's routing table now contains only intra-area routes and a single default route.
- Confirm the count of LSAs in R7's LSDB is reduced compared to Task 2.

**Verification:** `show ip ospf database` on R7 must show only Type 1 LSAs (Router LSAs for R3 and R7) and one Type 3 LSA (the default route). `show ip route ospf` on R7 must show only `O*IA 0.0.0.0/0` — no other OSPF routes.

---

### Task 4: Configure ABR Route Summarization

- On R3, configure the OSPF ABR to summarize the Area 2 prefixes (the R3-R7 link subnet and R7's loopback) into a single aggregate route advertised toward Area 0.
- Use the smallest possible supernet that covers both 10.7.7.7/32 and 10.37.0.0/30.
- Verify that the individual Area 2 prefixes are suppressed in the backbone and replaced by the summary.

**Verification:** `show ip route ospf` on R1 and R2 must show the summary prefix (`O IA`) and must NOT show the individual component routes (10.7.7.7/32 and 10.37.0.0/30 as separate entries). `show ip ospf database summary` on R1 confirms the aggregate Type 3 LSA originated by R3.

---

## 6. Verification & Analysis

### Task 1 Verification — R7 in Normal Area 2

```
R3# show ip ospf neighbor
Neighbor ID     Pri   State           Dead Time   Address         Interface
10.2.2.2          1   FULL/DR         00:00:38    10.23.0.1       FastEthernet0/0
10.1.1.1          1   FULL/  -        00:00:39    10.13.0.1       FastEthernet0/1
10.7.7.7          1   FULL/DR         00:00:31    10.37.0.2       FastEthernet1/1  ! ← R7 must be FULL state

R7# show ip route ospf
O IA  10.1.1.1 [110/2] via 10.37.0.1, 00:00:20, FastEthernet0/0  ! ← inter-area route visible
O IA  10.2.2.2 [110/3] via 10.37.0.1, 00:00:20, FastEthernet0/0  ! ← inter-area route visible
O IA  10.3.3.3 [110/2] via 10.37.0.1, 00:00:20, FastEthernet0/0  ! ← inter-area route visible
O IA  10.12.0.0 [110/3] via 10.37.0.1, 00:00:20, FastEthernet0/0 ! ← backbone subnet visible
O IA  10.13.0.0 [110/3] via 10.37.0.1, 00:00:20, FastEthernet0/0 ! ← backbone subnet visible
O IA  10.23.0.0 [110/3] via 10.37.0.1, 00:00:20, FastEthernet0/0 ! ← Area 1 subnet visible

R7# show ip ospf database
            OSPF Router with ID (10.7.7.7) (Process ID 1)

                Router Link States (Area 2)
Link ID         ADV Router      Age  Seq#       Checksum Link count
10.3.3.3        10.3.3.3         45  0x80000002 0x00XXXX 1   ! ← R3 Router LSA
10.7.7.7        10.7.7.7         42  0x80000002 0x00XXXX 2   ! ← R7 Router LSA

                Summary Net Link States (Area 2)
Link ID         ADV Router      Age  Seq#       Checksum
10.1.1.1        10.3.3.3         45  0x80000001 0x00XXXX  ! ← Type 3: R1 loopback
10.2.2.2        10.3.3.3         45  0x80000001 0x00XXXX  ! ← Type 3: R2 loopback
10.3.3.3        10.3.3.3         45  0x80000001 0x00XXXX  ! ← Type 3: R3 loopback
10.12.0.0       10.3.3.3         45  0x80000001 0x00XXXX  ! ← Type 3: backbone subnet
10.13.0.0       10.3.3.3         45  0x80000001 0x00XXXX  ! ← Type 3: backbone subnet
10.23.0.0       10.3.3.3         45  0x80000001 0x00XXXX  ! ← Type 3: Area 1 subnet
```

### Task 2 Verification — Stub Area

```
R7# show ip ospf database
            OSPF Router with ID (10.7.7.7) (Process ID 1)

                Router Link States (Area 2)
Link ID         ADV Router      Age  Seq#       Checksum Link count
10.3.3.3        10.3.3.3         12  0x80000003 0x00XXXX 1
10.7.7.7        10.7.7.7         10  0x80000003 0x00XXXX 2

                Summary Net Link States (Area 2)
Link ID         ADV Router      Age  Seq#       Checksum
0.0.0.0         10.3.3.3         12  0x80000001 0x00XXXX  ! ← Default route MUST appear here
10.1.1.1        10.3.3.3         12  0x80000001 0x00XXXX  ! ← Inter-area routes still present in stub
10.2.2.2        10.3.3.3         12  0x80000001 0x00XXXX
10.3.3.3        10.3.3.3         12  0x80000001 0x00XXXX
10.12.0.0       10.3.3.3         12  0x80000001 0x00XXXX
10.13.0.0       10.3.3.3         12  0x80000001 0x00XXXX
10.23.0.0       10.3.3.3         12  0x80000001 0x00XXXX
! NOTE: No "Summary ASB Link States" section — Type 4 absent
! NOTE: No "Type-5 AS External Link States" section — Type 5 absent

R7# show ip route ospf
O*IA  0.0.0.0/0 [110/2] via 10.37.0.1, 00:00:15, FastEthernet0/0  ! ← default route present
O IA  10.1.1.1 [110/2] via 10.37.0.1, 00:00:15, FastEthernet0/0
O IA  10.2.2.2 [110/3] via 10.37.0.1, 00:00:15, FastEthernet0/0
O IA  10.3.3.3 [110/2] via 10.37.0.1, 00:00:15, FastEthernet0/0
O IA  10.12.0.0 [110/3] via 10.37.0.1, 00:00:15, FastEthernet0/0
O IA  10.13.0.0 [110/3] via 10.37.0.1, 00:00:15, FastEthernet0/0
O IA  10.23.0.0 [110/3] via 10.37.0.1, 00:00:15, FastEthernet0/0
```

### Task 3 Verification — Totally Stubby Area

```
R7# show ip ospf database
            OSPF Router with ID (10.7.7.7) (Process ID 1)

                Router Link States (Area 2)
Link ID         ADV Router      Age  Seq#       Checksum Link count
10.3.3.3        10.3.3.3          8  0x80000004 0x00XXXX 1   ! ← only intra-area Type 1 LSAs
10.7.7.7        10.7.7.7          6  0x80000004 0x00XXXX 2   ! ← only intra-area Type 1 LSAs

                Summary Net Link States (Area 2)
Link ID         ADV Router      Age  Seq#       Checksum
0.0.0.0         10.3.3.3          8  0x80000002 0x00XXXX  ! ← ONLY this Type 3 LSA must remain
! All other Type 3 Summary LSAs have been filtered by R3's no-summary

R7# show ip route ospf
O*IA  0.0.0.0/0 [110/2] via 10.37.0.1, 00:00:08, FastEthernet0/0  ! ← only OSPF route
! No other O IA routes — all inter-area prefixes suppressed

R7# show ip route
Codes: C - connected, S - static, O - OSPF, IA - inter area
Gateway of last resort is 10.37.0.1 to network 0.0.0.0

C     10.7.7.7/32 is directly connected, Loopback0
C     10.37.0.0/30 is directly connected, FastEthernet0/0
O*IA  0.0.0.0/0 [110/2] via 10.37.0.1, FastEthernet0/0  ! ← gateway of last resort set
```

### Task 4 Verification — ABR Summarization

```
R1# show ip route ospf
O IA  10.7.0.0/13 [110/3] via 10.12.0.2, 00:00:12, FastEthernet1/0  ! ← summary present
! Individual routes 10.7.7.7/32 and 10.37.0.0/30 must NOT appear separately

R3# show ip ospf database summary
            OSPF Router with ID (10.3.3.3) (Process ID 1)

                Summary Net Link States (Area 0)
Link ID         ADV Router      Age  Seq#       Checksum
10.7.0.0        10.3.3.3         20  0x80000001 0x00XXXX  ! ← summary LSA originated by R3
! Component routes (10.7.7.7 and 10.37.0.0) must NOT appear as individual Type 3 LSAs in Area 0

R3# show ip route
O    10.7.0.0/13 is a summary, Null0  ! ← null route installed for loop prevention
```

---

## 7. Verification Cheatsheet

### OSPF Area Type Configuration

```
router ospf 1
 area 2 stub             ! Stub — applied to ALL routers in area
 area 2 stub no-summary  ! Totally Stubby — ABR only
 area 2 range <net> <mask>  ! ABR summarization
```

| Command                                    | Purpose                                                      |
|--------------------------------------------|--------------------------------------------------------------|
| `area X stub`                              | Configure stub area (blocks Type 4 and 5 LSAs)               |
| `area X stub no-summary`                   | Totally Stubby — also blocks inter-area Type 3 LSAs (ABR only) |
| `area X range <network> <mask>`            | Summarize component routes from area X into backbone         |
| `area X default-cost <value>`              | Override the default route metric sent into the stub area    |

> **Exam tip:** A stub area adjacency will not form if there is a mismatch — one side `stub`, the other normal. The E-bit in OSPF Hello packets signals stub capability; a mismatch causes the Hello to be rejected.

### OSPF Database Verification

```
show ip ospf database
show ip ospf database summary
show ip ospf database router
show ip ospf database external
```

| Command                            | What to Look For                                              |
|------------------------------------|---------------------------------------------------------------|
| `show ip ospf database`            | Full LSDB — confirm absence of Type 4 and 5 sections in stub |
| `show ip ospf database summary`    | Type 3 LSAs — default route (0.0.0.0) must appear in stub    |
| `show ip ospf database external`   | Type 5 LSAs — must be absent in stub and totally stubby areas |
| `show ip ospf database asbr-summary` | Type 4 LSAs — must be absent in stub areas                  |

### Routing Table Verification

```
show ip route ospf
show ip route
show ip ospf neighbor
```

| Command                  | What to Look For                                                         |
|--------------------------|--------------------------------------------------------------------------|
| `show ip route ospf`     | `O*IA 0.0.0.0/0` present; no `O E1` or `O E2` routes in stub areas      |
| `show ip route`          | Gateway of last resort set to ABR address in stub areas                  |
| `show ip ospf neighbor`  | R7 in FULL state; adjacency drops if area type mismatch exists           |

### Wildcard Mask Quick Reference

| Subnet Mask         | Wildcard Mask       | Common Use                    |
|---------------------|---------------------|-------------------------------|
| 255.255.255.255     | 0.0.0.0             | Host route / loopback         |
| 255.255.255.252     | 0.0.0.3             | /30 point-to-point link       |
| 255.255.255.0       | 0.0.0.255           | /24 stub LAN                  |
| 255.255.0.0         | 0.0.255.255         | /16 summary range             |

### Common OSPF Stub Area Failure Causes

| Symptom                               | Likely Cause                                                    |
|---------------------------------------|-----------------------------------------------------------------|
| R7 shows no OSPF neighbors            | Area type mismatch (one side stub, other side normal)           |
| Default route missing in R7 routing table | Stub config removed from ABR (R3)                           |
| R7 routing table has hundreds of routes | Stub config not applied — Area 2 is still a normal area      |
| R7 still sees inter-area routes in totally stubby | `no-summary` not configured on R3 (ABR)             |
| Summary route missing from backbone   | `area range` not configured on R3, or range is too specific     |
| Null0 route installed on R3           | Expected — OSPF installs discard route to prevent loops when summarizing |

---

## 8. Solutions (Spoiler Alert!)

> Try to complete the lab challenge without looking at these steps first!

### Task 1: Establish R7 in OSPF (Normal Area 2)

<details>
<summary>Click to view R3 Configuration</summary>

```bash
! R3 — add Area 2 network statement (no stub yet)
router ospf 1
 network 10.37.0.0 0.0.0.3 area 2
```
</details>

<details>
<summary>Click to view R7 Configuration</summary>

```bash
! R7
router ospf 1
 router-id 10.7.7.7
 network 10.7.7.7 0.0.0.0 area 2
 network 10.37.0.0 0.0.0.3 area 2
```
</details>

<details>
<summary>Click to view Verification Commands</summary>

```bash
show ip ospf neighbor
show ip ospf database
show ip route ospf
```
</details>

---

### Task 2: Configure Area 2 as Stub

<details>
<summary>Click to view R3 Configuration</summary>

```bash
! R3 — configure stub on the ABR
router ospf 1
 area 2 stub
```
</details>

<details>
<summary>Click to view R7 Configuration</summary>

```bash
! R7 — configure stub on the internal router
router ospf 1
 area 2 stub
```
</details>

<details>
<summary>Click to view Verification Commands</summary>

```bash
show ip ospf neighbor
show ip ospf database
show ip route ospf
! Confirm: "Summary Net Link States" includes 0.0.0.0 (default)
! Confirm: No "Type-5 AS External" section in database output
```
</details>

---

### Task 3: Upgrade to Totally Stubby

<details>
<summary>Click to view R3 Configuration</summary>

```bash
! R3 — add no-summary to suppress inter-area Type 3 LSAs
router ospf 1
 area 2 stub no-summary
! R7 requires NO configuration change
```
</details>

<details>
<summary>Click to view Verification Commands</summary>

```bash
show ip ospf database
! Confirm: Only Router LSAs (Type 1) and one Summary LSA (0.0.0.0) remain in Area 2
show ip route ospf
! Confirm: Only O*IA 0.0.0.0/0 appears — no other OSPF routes on R7
```
</details>

---

### Task 4: ABR Route Summarization

<details>
<summary>Click to view R3 Configuration</summary>

```bash
! R3 — summarize Area 2 prefixes (10.7.7.7/32 and 10.37.0.0/30)
! Supernet that covers both: 10.0.0.0/8 is too broad;
! use 10.7.0.0/13 as the smallest clean supernet covering both prefixes
router ospf 1
 area 2 range 10.7.0.0 255.248.0.0
```
</details>

<details>
<summary>Click to view Verification Commands</summary>

```bash
! On R1 and R2 — confirm summary present, components absent
show ip route ospf

! On R3 — confirm null route and originating LSA
show ip route
show ip ospf database summary
```
</details>

---

## 9. Troubleshooting Scenarios

Each ticket simulates a real-world fault. Inject the fault first, then diagnose and fix using only show commands and targeted configuration changes.

### Workflow

```bash
python3 setup_lab.py                                   # reset to known-good state
python3 scripts/fault-injection/inject_scenario_01.py  # Ticket 1
python3 scripts/fault-injection/apply_solution.py      # restore after each ticket
```

---

### Ticket 1 — R7 Reports No OSPF Neighbors After Maintenance Window

A network change was applied to R3 during last night's maintenance window. This morning, the NOC reports that R7 has no OSPF adjacencies and is unreachable via OSPF.

**Inject:** `python3 scripts/fault-injection/inject_scenario_01.py`

**Success criteria:** `show ip ospf neighbor` on R3 shows R7 in FULL state. R7's routing table includes the default route.

<details>
<summary>Click to view Diagnosis Steps</summary>

```bash
! Step 1: Check OSPF neighbors on R7
R7# show ip ospf neighbor
! Expected: empty output — no neighbors

! Step 2: Check OSPF neighbors on R3
R3# show ip ospf neighbor
! Expected: R7 absent

! Step 3: Verify area type configuration on both sides
R7# show ip ospf
! Look for: "Area 2 is a stub area" in the area block
R3# show ip ospf
! Look for: "Area 2 is a stub area" — if missing, area type mismatch

! Step 4: Check Hello packet exchange
R7# debug ip ospf hello
! Look for: "Mismatched hello parameters from..." or "E-bit mismatch"

! Root cause: R3 no longer has Area 2 configured as stub.
! R7 sends Hellos with E-bit=0 (stub). R3 expects E-bit=1 (normal).
! Hellos are rejected — adjacency cannot form.
```
</details>

<details>
<summary>Click to view Fix</summary>

```bash
! On R3 — restore stub configuration
R3(config)# router ospf 1
R3(config-router)# area 2 stub no-summary
! Adjacency re-establishes automatically within one dead interval (40 seconds)
```
</details>

---

### Ticket 2 — R7 Routing Table Contains Only Connected Routes

An engineer was asked to add a new router to Area 2 and made changes to R3's OSPF configuration. Now R7 forms no OSPF adjacency and has lost all OSPF-learned routes.

**Inject:** `python3 scripts/fault-injection/inject_scenario_02.py`

**Success criteria:** R7 re-establishes full OSPF adjacency with R3 and routing table contains the default route.

<details>
<summary>Click to view Diagnosis Steps</summary>

```bash
! Step 1: Check R7 neighbors
R7# show ip ospf neighbor
! Expected: no neighbors

! Step 2: Ping R3's Fa1/1 address from R7
R7# ping 10.37.0.1
! Expected: may succeed (Layer 3 reachability OK — OSPF issue is configuration only)

! Step 3: Check if R3 has R7's subnet in OSPF
R3# show ip ospf interface FastEthernet1/1
! Look for: OSPF enabled on this interface? If interface is passive or not in OSPF, adjacency fails

! Step 4: Check the running config on R3
R3# show running-config | section ospf
! Look for: network statement for 10.37.0.0 area — if missing or wrong area, R7 can't join

! Root cause: network statement for 10.37.0.0/30 is missing or assigned to wrong area on R3.
```
</details>

<details>
<summary>Click to view Fix</summary>

```bash
! On R3 — restore the Area 2 network statement
R3(config)# router ospf 1
R3(config-router)# network 10.37.0.0 0.0.0.3 area 2
! Adjacency forms within one Hello interval (10 seconds)
```
</details>

---

### Ticket 3 — R7 Has an Unexpectedly Large Routing Table

A junior engineer reports that R7's routing table shows all enterprise routes — over 15 entries — despite being designed as a minimal branch stub. Ticket notes indicate the area "seems fully meshed now."

**Inject:** `python3 scripts/fault-injection/inject_scenario_03.py`

**Success criteria:** R7's routing table contains only the default route from OSPF. `show ip ospf database` on R7 shows no inter-area Type 3 LSAs except the default.

<details>
<summary>Click to view Diagnosis Steps</summary>

```bash
! Step 1: Verify R7's routing table size
R7# show ip route ospf
! Expected (fault active): many O IA routes visible — Area 2 is receiving all Type 3 LSAs

! Step 2: Check R7's OSPF database
R7# show ip ospf database
! Look for: Many "Summary Net Link States" entries — confirms Type 3 LSAs flooding in

! Step 3: Verify Area 2 type on R3
R3# show ip ospf
! Look for area 2 description — if it says "Stub area" without "no summary" filtering,
! or if area 2 shows as a "Normal" area, that explains the full route table

! Step 4: Check R3 running config
R3# show running-config | section ospf
! Look for: "area 2 stub no-summary" — if only "area 2 stub" present, totally stubby not active
! If "area 2 stub" absent entirely, Area 2 is a normal area — all LSAs flood freely

! Root cause: area 2 stub no-summary removed from R3. Area 2 reverted to regular stub
! (or normal area), allowing all inter-area Type 3 LSAs to flood into Area 2.
```
</details>

<details>
<summary>Click to view Fix</summary>

```bash
! On R3 — restore totally stubby configuration
R3(config)# router ospf 1
R3(config-router)# area 2 stub no-summary
! R3 immediately withdraws inter-area Type 3 LSAs from Area 2 (except default route)
! R7's routing table shrinks to connected routes + one default within SPF convergence time
```
</details>

---

## 10. Lab Completion Checklist

### Core Implementation

- [ ] R7 establishes OSPF adjacency with R3 in a normal Area 2
- [ ] R7 routing table shows inter-area routes from Area 0 and Area 1 before stub config
- [ ] Area 2 configured as stub on both R3 and R7 — adjacency re-establishes
- [ ] `show ip ospf database` on R7 shows no Type 4 or Type 5 LSA sections
- [ ] Default route (0.0.0.0/0) appears as `O*IA` in R7's routing table
- [ ] Area 2 upgraded to totally stubby via `no-summary` on R3 only
- [ ] R7's LSDB contains only Type 1 Router LSAs and one Type 3 default
- [ ] R7's routing table contains only connected routes and one `O*IA 0.0.0.0/0`
- [ ] ABR summarization configured on R3 for Area 2 prefixes
- [ ] Summary route visible on R1 and R2 — component routes absent

### Troubleshooting

- [ ] Ticket 1 resolved: area type mismatch identified and corrected on R3
- [ ] Ticket 2 resolved: missing network statement identified and restored on R3
- [ ] Ticket 3 resolved: totally stubby configuration restored; R7 routing table reduced to default only
